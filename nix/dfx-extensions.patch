diff --git a/Cargo.lock b/Cargo.lock
index db05dd8..01cf83d 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -3309,8 +3309,8 @@ dependencies = [
  "hyper-util",
  "ic-adapter-metrics-service",
  "ic-http-endpoints-async-utils",
- "prometheus",
- "protobuf",
+ "prometheus 0.14.0",
+ "protobuf 3.7.2",
  "slog",
  "tokio",
  "tonic",
@@ -3326,7 +3326,7 @@ dependencies = [
  "ic-adapter-metrics-service",
  "ic-logger",
  "ic-metrics",
- "protobuf",
+ "protobuf 3.7.2",
  "slog",
  "tokio",
  "tonic",
@@ -3410,7 +3410,7 @@ dependencies = [
  "lmdb-rkv",
  "lmdb-rkv-sys",
  "nix 0.24.3",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "rocksdb",
  "serde",
@@ -3432,7 +3432,7 @@ dependencies = [
  "comparable",
  "hex",
  "ic-crypto-sha2",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-protobuf",
  "phantom_newtype",
  "prost 0.13.5",
@@ -3456,7 +3456,7 @@ dependencies = [
  "ic-interfaces-adapter-client",
  "ic-logger",
  "ic-metrics",
- "prometheus",
+ "prometheus 0.14.0",
  "serde",
  "serde_bytes",
  "slog",
@@ -3483,7 +3483,7 @@ dependencies = [
  "ic-protobuf",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "slog",
  "thiserror 2.0.18",
@@ -3582,7 +3582,7 @@ dependencies = [
  "nix 0.24.3",
  "num-traits",
  "once_cell",
- "prometheus",
+ "prometheus 0.14.0",
  "rayon",
  "regex",
  "serde",
@@ -3639,7 +3639,7 @@ dependencies = [
  "candid",
  "ic-cdk-executor",
  "ic-cdk-macros",
- "ic-error-types 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)",
+ "ic-error-types 0.2.0 (git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0)",
  "ic-management-canister-types 0.5.0",
  "ic0",
  "pin-project-lite",
@@ -3774,7 +3774,7 @@ dependencies = [
  "ic-replicated-state",
  "ic-types",
  "num-traits",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "rand_chacha 0.3.1",
  "rayon",
@@ -3795,7 +3795,7 @@ dependencies = [
  "ic-metrics",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "slog",
  "tokio",
 ]
@@ -3832,7 +3832,7 @@ dependencies = [
  "ic-registry-client-helpers",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "rayon",
  "slog",
 ]
@@ -3857,7 +3857,7 @@ dependencies = [
  "ic-registry-subnet-features",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "rayon",
  "slog",
@@ -3877,7 +3877,7 @@ dependencies = [
  "ic-registry-client-helpers",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "slog",
 ]
@@ -3901,7 +3901,7 @@ dependencies = [
  "ic-replicated-state",
  "ic-types",
  "num-traits",
- "prometheus",
+ "prometheus 0.14.0",
  "rayon",
  "slog",
 ]
@@ -4183,7 +4183,7 @@ version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
  "ic-metrics",
- "prometheus",
+ "prometheus 0.14.0",
  "strum 0.26.3",
  "strum_macros 0.26.4",
 ]
@@ -4645,7 +4645,7 @@ dependencies = [
  "ic-registry-subnet-type",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "serde",
  "slog",
 ]
@@ -4688,7 +4688,7 @@ dependencies = [
  "ic-config",
  "ic-cycles-account-manager",
  "ic-error-types 0.2.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-interfaces",
  "ic-limits",
  "ic-logger",
@@ -4709,7 +4709,7 @@ dependencies = [
  "memory_tracker",
  "nix 0.24.3",
  "num-traits",
- "prometheus",
+ "prometheus 0.14.0",
  "rayon",
  "rustc-demangle",
  "scopeguard",
@@ -4727,9 +4727,9 @@ dependencies = [
 [[package]]
 name = "ic-error-types"
 version = "0.2.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "bbeeb3d91aa179d6496d7293becdacedfc413c825cac79fd54ea1906f003ee55"
+source = "git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0#1bc0a59539613f6ec273a59a172ae43dfabb1ce0"
 dependencies = [
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0)",
  "serde",
  "strum 0.26.3",
  "strum_macros 0.26.4",
@@ -4740,7 +4740,7 @@ name = "ic-error-types"
 version = "0.2.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "regex-lite",
  "serde",
  "strum 0.26.3",
@@ -4765,7 +4765,7 @@ dependencies = [
  "ic-cycles-account-manager",
  "ic-embedders",
  "ic-error-types 0.2.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-interfaces",
  "ic-interfaces-state-manager",
  "ic-limits",
@@ -4793,7 +4793,7 @@ dependencies = [
  "num-rational",
  "num-traits",
  "phantom_newtype",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "scoped_threadpool",
  "serde",
@@ -4807,18 +4807,41 @@ dependencies = [
  "wasmparser 0.243.0",
 ]
 
+[[package]]
+name = "ic-heap-bytes"
+version = "0.9.0"
+source = "git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0#1bc0a59539613f6ec273a59a172ae43dfabb1ce0"
+dependencies = [
+ "candid",
+ "ic-heap-bytes-derive 0.9.0 (git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0)",
+ "paste",
+ "prometheus 0.13.4",
+ "tempfile",
+]
+
 [[package]]
 name = "ic-heap-bytes"
 version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
  "candid",
- "ic-heap-bytes-derive",
+ "ic-heap-bytes-derive 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "paste",
- "prometheus",
+ "prometheus 0.14.0",
  "tempfile",
 ]
 
+[[package]]
+name = "ic-heap-bytes-derive"
+version = "0.9.0"
+source = "git+https://github.com/dfinity/ic?rev=1bc0a59539613f6ec273a59a172ae43dfabb1ce0#1bc0a59539613f6ec273a59a172ae43dfabb1ce0"
+dependencies = [
+ "darling 0.20.11",
+ "proc-macro2",
+ "quote",
+ "syn 2.0.114",
+]
+
 [[package]]
 name = "ic-heap-bytes-derive"
 version = "0.9.0"
@@ -4888,7 +4911,7 @@ dependencies = [
  "ic-utils 0.9.0",
  "ic-validator",
  "inferno 0.12.3",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "serde",
  "serde_cbor",
@@ -4951,7 +4974,7 @@ dependencies = [
  "ic-replicated-state",
  "ic-types",
  "ic-utils 0.9.0",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "slog",
 ]
@@ -5106,7 +5129,7 @@ dependencies = [
  "ic-replicated-state",
  "ic-types",
  "ic-validator",
- "prometheus",
+ "prometheus 0.14.0",
  "slog",
 ]
 
@@ -5118,7 +5141,7 @@ dependencies = [
  "ic-base-types",
  "ic-crypto-interfaces-sig-verification",
  "ic-error-types 0.2.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-management-canister-types-private",
  "ic-protobuf",
  "ic-registry-provisional-whitelist",
@@ -5308,7 +5331,7 @@ dependencies = [
  "ic-replicated-state",
  "ic-types",
  "ic-utils-thread",
- "prometheus",
+ "prometheus 0.14.0",
  "slog",
  "tracing",
 ]
@@ -5322,8 +5345,8 @@ dependencies = [
  "ic-adapter-metrics-client",
  "libc",
  "parking_lot",
- "procfs",
- "prometheus",
+ "procfs 0.17.0",
+ "prometheus 0.14.0",
  "tokio-metrics",
 ]
 
@@ -5691,7 +5714,7 @@ dependencies = [
  "ic-metrics",
  "ic-registry-client-helpers",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "serde",
  "serde_cbor",
@@ -5800,7 +5823,7 @@ dependencies = [
  "ic-metrics",
  "ic-replicated-state",
  "ic-types",
- "prometheus",
+ "prometheus 0.14.0",
  "slog",
 ]
 
@@ -6013,7 +6036,7 @@ dependencies = [
  "maplit",
  "nix 0.24.3",
  "phantom_newtype",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "rand 0.8.5",
  "rand_chacha 0.3.1",
@@ -6425,7 +6448,7 @@ dependencies = [
  "ic-utils-thread",
  "ic-wasm-types",
  "libc",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "scoped_threadpool",
  "slog",
@@ -6537,7 +6560,7 @@ dependencies = [
  "ic-wasm-types",
  "nix 0.24.3",
  "parking_lot",
- "prometheus",
+ "prometheus 0.14.0",
  "prost 0.13.5",
  "rand 0.8.5",
  "rand_chacha 0.3.1",
@@ -6630,7 +6653,7 @@ version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
  "ic-metrics",
- "prometheus",
+ "prometheus 0.14.0",
 ]
 
 [[package]]
@@ -6739,7 +6762,7 @@ dependencies = [
  "ic-crypto-sha2",
  "ic-crypto-tree-hash",
  "ic-error-types 0.2.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-limits",
  "ic-management-canister-types-private",
  "ic-protobuf",
@@ -6811,7 +6834,7 @@ name = "ic-utils-lru-cache"
 version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-types",
  "lru",
 ]
@@ -6923,7 +6946,7 @@ version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
  "ic-crypto-sha2",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "ic-sys",
  "ic-types",
  "ic-utils 0.9.0",
@@ -6976,7 +6999,7 @@ dependencies = [
  "ic-types",
  "ic-xnet-hyper",
  "ic-xnet-uri",
- "prometheus",
+ "prometheus 0.14.0",
  "rand 0.8.5",
  "slog",
  "thiserror 2.0.18",
@@ -8550,7 +8573,7 @@ version = "0.9.0"
 source = "git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a#b291fd30707aeee276cdae62c35b404adcb9f11a"
 dependencies = [
  "candid",
- "ic-heap-bytes",
+ "ic-heap-bytes 0.9.0 (git+https://github.com/dfinity/ic?rev=b291fd30707aeee276cdae62c35b404adcb9f11a)",
  "num-traits",
  "serde",
  "slog",
@@ -8948,6 +8971,19 @@ dependencies = [
  "unicode-ident",
 ]
 
+[[package]]
+name = "procfs"
+version = "0.16.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "731e0d9356b0c25f16f33b5be79b1c57b562f141ebfcdb0ad8ac2c13a24293b4"
+dependencies = [
+ "bitflags 2.9.4",
+ "hex",
+ "lazy_static",
+ "procfs-core 0.16.0",
+ "rustix 0.38.44",
+]
+
 [[package]]
 name = "procfs"
 version = "0.17.0"
@@ -8956,10 +8992,20 @@ checksum = "cc5b72d8145275d844d4b5f6d4e1eef00c8cd889edb6035c21675d1bb1f45c9f"
 dependencies = [
  "bitflags 2.9.4",
  "hex",
- "procfs-core",
+ "procfs-core 0.17.0",
  "rustix 0.38.44",
 ]
 
+[[package]]
+name = "procfs-core"
+version = "0.16.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "2d3554923a69f4ce04c4a754260c338f505ce22642d3830e049a399fc2059a29"
+dependencies = [
+ "bitflags 2.9.4",
+ "hex",
+]
+
 [[package]]
 name = "procfs-core"
 version = "0.17.0"
@@ -8970,6 +9016,23 @@ dependencies = [
  "hex",
 ]
 
+[[package]]
+name = "prometheus"
+version = "0.13.4"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "3d33c28a30771f7f96db69893f78b857f7450d7e0237e9c8fc6427a81bae7ed1"
+dependencies = [
+ "cfg-if",
+ "fnv",
+ "lazy_static",
+ "libc",
+ "memchr",
+ "parking_lot",
+ "procfs 0.16.0",
+ "protobuf 2.28.0",
+ "thiserror 1.0.69",
+]
+
 [[package]]
 name = "prometheus"
 version = "0.14.0"
@@ -8982,8 +9045,8 @@ dependencies = [
  "libc",
  "memchr",
  "parking_lot",
- "procfs",
- "protobuf",
+ "procfs 0.17.0",
+ "protobuf 3.7.2",
  "thiserror 2.0.18",
 ]
 
@@ -9112,6 +9175,12 @@ dependencies = [
  "prost 0.13.5",
 ]
 
+[[package]]
+name = "protobuf"
+version = "2.28.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "106dd99e98437432fed6519dedecfade6a06a73bb7b2a1e019fdd2bee5778d94"
+
 [[package]]
 name = "protobuf"
 version = "3.7.2"
diff --git a/Cargo.toml b/Cargo.toml
index b44a2ca..b18190b 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -50,3 +50,6 @@ ic-sns-cli        = { git = "https://github.com/dfinity/ic", rev = "b291fd30707a
 [profile.dist]
 inherits = "release"
 lto = "thin"
+
+[patch.crates-io]
+ic-error-types = { git = "https://github.com/dfinity/ic", rev = "1bc0a59539613f6ec273a59a172ae43dfabb1ce0" }
diff --git a/extensions/nns/Cargo.toml b/extensions/nns/Cargo.toml
index a2b08fb..d45667e 100644
--- a/extensions/nns/Cargo.toml
+++ b/extensions/nns/Cargo.toml
@@ -6,7 +6,7 @@ edition.workspace = true
 license.workspace = true
 repository.workspace = true
 publish.workspace = true
-build = "build.rs"
+
 
 [build-dependencies]
 dfx-extensions-utils.workspace = true
diff --git a/extensions/nns/build.rs b/extensions/nns/build.rs
deleted file mode 100644
index 4b2a73e..0000000
--- a/extensions/nns/build.rs
+++ /dev/null
@@ -1,39 +0,0 @@
-use dfx_extensions_utils::dependencies::dfx::NNS_SNS_REPLICA_REV;
-use std::env;
-use std::path::PathBuf;
-
-const BINARY_DEPENDENCIES: &[(&str, &str)] = &[
-    // (downloaded binary name, renamed binary name)
-    ("ic-nns-init", "ic-nns-init"),
-    ("ic-admin", "ic-admin"),
-    ("sns", "sns-cli"),
-];
-
-fn main() {
-    // keep copy of the dependency in the root of the project, so that cargo-dist will be able to package it into a tarball
-    let manifest_dir = PathBuf::from(env::var("CARGO_MANIFEST_DIR").unwrap());
-    // and also in `target/debug` or `target/release` for development purposes (e.g. cargo run), this is a bit hacky: https://github.com/rust-lang/cargo/issues/9661
-    let target_dir = PathBuf::from(std::env::var("OUT_DIR").unwrap())
-        .parent()
-        .unwrap()
-        .parent()
-        .unwrap()
-        .parent()
-        .unwrap()
-        .to_path_buf();
-    for (binary_name, renamed_binary_name) in BINARY_DEPENDENCIES {
-        let bin_in_manifest_dir = manifest_dir.join(renamed_binary_name);
-        let bin_in_target_dir = target_dir.join(renamed_binary_name);
-        dbg!(&bin_in_manifest_dir, &bin_in_target_dir);
-        dfx_extensions_utils::download_ic_binary(
-            NNS_SNS_REPLICA_REV,
-            binary_name,
-            &bin_in_manifest_dir,
-        );
-        if bin_in_target_dir.exists() {
-            std::fs::remove_file(&bin_in_target_dir).unwrap();
-        }
-        std::fs::create_dir_all(&target_dir).unwrap();
-        std::fs::copy(&bin_in_manifest_dir, &bin_in_target_dir).unwrap();
-    }
-}
diff --git a/extensions/sns/Cargo.toml b/extensions/sns/Cargo.toml
index e29f602..38f3163 100644
--- a/extensions/sns/Cargo.toml
+++ b/extensions/sns/Cargo.toml
@@ -6,7 +6,7 @@ edition.workspace = true
 license.workspace = true
 repository.workspace = true
 publish.workspace = true
-build = "build.rs"
+
 
 [build-dependencies]
 dfx-extensions-utils.workspace = true
diff --git a/extensions/sns/build.rs b/extensions/sns/build.rs
deleted file mode 100644
index 01870ab..0000000
--- a/extensions/sns/build.rs
+++ /dev/null
@@ -1,37 +0,0 @@
-use dfx_extensions_utils::dependencies::dfx::NNS_SNS_REPLICA_REV;
-use std::env;
-use std::path::PathBuf;
-
-const BINARY_DEPENDENCIES: &[(&str, &str)] = &[
-    // (downloaded binary name, renamed binary name)
-    ("sns", "sns-cli"),
-];
-
-fn main() {
-    // keep copy of the dependency in the root of the project, so that cargo-dist will be able to package it into a tarball
-    let manifest_dir = PathBuf::from(env::var("CARGO_MANIFEST_DIR").unwrap());
-    // and also in `target/debug` or `target/release` for development purposes (e.g. cargo run), this is a bit hacky: https://github.com/rust-lang/cargo/issues/9661
-    let target_dir = PathBuf::from(std::env::var("OUT_DIR").unwrap())
-        .parent()
-        .unwrap()
-        .parent()
-        .unwrap()
-        .parent()
-        .unwrap()
-        .to_path_buf();
-    for (binary_name, renamed_binary_name) in BINARY_DEPENDENCIES {
-        let bin_in_manifest_dir = manifest_dir.join(renamed_binary_name);
-        let bin_in_target_dir = target_dir.join(renamed_binary_name);
-        dbg!(&bin_in_manifest_dir, &bin_in_target_dir);
-        dfx_extensions_utils::download_ic_binary(
-            NNS_SNS_REPLICA_REV,
-            binary_name,
-            &bin_in_manifest_dir,
-        );
-        if bin_in_target_dir.exists() {
-            std::fs::remove_file(&bin_in_target_dir).unwrap();
-        }
-        std::fs::create_dir_all(&target_dir).unwrap();
-        std::fs::copy(&bin_in_manifest_dir, &bin_in_target_dir).unwrap();
-    }
-}
